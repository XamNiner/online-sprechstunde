<!DOCTYPE html>
<html ng-app="chatApp">

<head>
   <!-- Latest compiled and minified CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css" rel="stylesheet" integrity="sha384-XYCjB+hFAjSbgf9yKUgbysEjaVLOXhCgATTEBpCqT1R3jvG5LGRAK5ZIyRbH5vpX" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> 
</head>
    
<body>
<div ng-controller="ChatCtrl as chat">
    <nav class="navbar navbar-default navbar-static-top navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand myLogo" href="#">Online Sprechstunde</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
                <img src="asset/tomedo_logo.png" height="50"  style="display: inline-block;">
                <span style="display: inline-block;"></span>
          </ul>
        <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Options <span class="caret"></span></a>
            <ul class="dropdown-menu dru">
                <div class="input-group input-group-sm">
                    <input type="text" class="form-control" placeholder="Id..." ng-model="chat.ownId">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-primary" ng-click="chat.makeId()">Set Peer Id</button>
                    </span>
                </div><!-- /input-group -->
                <li role="separator" class="divider"></li>
                <div class="input-group input-group-sm">
                    <input type="text" class="form-control" placeholder="Name..." ng-model="chat.newName">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-primary" ng-click="chat.setName()">Set Name</button>
                    </span>
                </div><!-- /input-group -->
                <li role="separator" class="divider"></li>

                <div class="input-group input-group">
                    <label class="input-group-btn">
                        <span class="btn btn-primary">
                            <span class="glyphicon glyphicon-folder-open"></span> <input type="file" style="display: none;" multiple custom-on-change="chat.upload">
                        </span>
                    </label>
                    <input type="text" class="form-control" readonly placeholder="<filename>" ng-model="chat.fname">
                </div><!-- /input-group -->
                 <li role="separator" class="divider"></li>
                <button type="button" class="btn btn-primary btn-block" ng-click="chat.sendFile()" ng-disabled="!chat.inCall"><span class="glyphicon glyphicon-transfer"></span>Send</button>
            </ul>
        </li>
            <img src="asset/zollsoft--small.png" height="50">
            </ul>
        </div>
      </div>
    </nav>
        
 <!--------COMPATIBILITY ERROR!-------->       
    <div ng-cloak ng-show="chat.noMedia">
        <div class="alert alert-danger" role="alert">Can't stream Video because getUserMedia is not available in your browser. Please use Firefox or Chrome!
        </div>
    </div>
    <div ng-cloak ng-show="chat.noCamera">
        <div class="alert alert-danger" role="alert">Access to camera was not granted. Please reload your browser and press allow when asked for permission!
        </div>
    </div>    
    
<!--------REMOTE VIDEO!-------->   
    <div class="container" ng-cloak ng-show="!chat.noMedia">
    <div class="row">
        <div class="col-md-8 stackem">
            <div class="jumbotron">
            <div class="embed-responsive embed-responsive-4by3">
                <div ng-show="chat.canCall">
                   <div class="input-group input-group-lg text-center">
                        <input type="text" class="form-control" placeholder="Call user id..." ng-model="chat.peerId">
                        <span class="input-group-btn">
                            <button class="btn btn-primary" type="button" ng-click="chat.sendRequest()" ng-disabled="!chat.canCall"><span class="glyphicon glyphicon-earphone gi-3x" style="vertical-align:top"></span></button>
                        </span>
                    </div><!-- /input-group -->
                </div>
                <div ng-show="chat.inCall">
                    <video id="remoteVideo" autoplay controls class="remoteVideo">Your Browser does not support video.</video>  
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-primary" ng-click="chat.hangUp()" ng-disabled="!chat.inCall">End Call</button>
                        <button type="button" class="btn btn-primary" ng-click="chat.isCollapsed = !chat.isCollapsed">Show Photos</button>
                    </div>
                </div>
            </div>
	       <hr>
<!--------Photo Display!-------->
        <div class="row">
        <div uib-collapse="chat.isCollapsed">
            <div ng-hide="!chat.gumedia">
                <canvas id="photo"></canvas>
            </div>
        <div class="col-md-3" ng-show="chat.picReady">
            <p>Snapshot</p>
            <div class="dropdown thumbs"> 
            <img ng-src="{{chat.snapImg}}" class="img-responsive thumbnail" alt="test" width="100" height="100">
            <div class="dropdown-content thumbs-content">
                <img ng-src="{{chat.snapImg}}" class="img-responsive thumbnail" alt="test" width="640" height="480">
            <div class="desc">Snapshot</div>
            </div>
        </div>
        </div>
        <div class="col-md-9">
        <div id="incoming">
            <p>Session Photos</p>
            <div ng-repeat="nails in chat.imgContainer track by $index" ng-switch="$index%4">
                <div class="row" ng-switch-when="0">
                    <div class="col-md-3">
                        <div class="dropdown thumbs"> 
                            <img ng-src="{{chat.imgContainer[$index].url}}" class="img-responsive thumbnail" width="100" height="100">
                        <div class="dropdown-content thumbs-content">
                            <img ng-src="{{chat.imgContainer[$index].url}}" class="img-responsive thumbnail" width="640" height="480">
                            <div class="desc">{{chat.imgContainer[$index].time}}</div>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dropdown thumbs"> 
                            <img ng-src="{{chat.imgContainer[$index+1].url}}" class="img-responsive thumbnail" width="100" height="100">
                        <div class="dropdown-content thumbs-content">
                            <img ng-src="{{chat.imgContainer[$index+1].url}}" class="img-responsive thumbnail" width="640" height="480">
                            <div class="desc">{{chat.imgContainer[$index+1].time}}</div>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dropdown thumbs"> 
                            <img ng-src="{{chat.imgContainer[$index+2].url}}" class="img-responsive thumbnail" width="100" height="100">
                        <div class="dropdown-content thumbs-content">
                            <img ng-src="{{chat.imgContainer[$index+2].url}}" class="img-responsive thumbnail" width="640" height="480">
                            <div class="desc">{{chat.imgContainer[$index+2].time}}</div>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dropdown thumbs"> 
                            <img ng-src="{{chat.imgContainer[$index+3].url}}" class="img-responsive thumbnail" width="100" height="100">
                        <div class="dropdown-content thumbs-content">
                            <img ng-src="{{chat.imgContainer[$index+3].url}}" class="img-responsive thumbnail" width="640" height="480">
                            <div class="desc">{{chat.imgContainer[$index+3].time}}</div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
	    </div>
        </div>
        </div>
        </div>
<!--------LOCAL VIDEO!-------->
        <div class="col-md-4">
            <div class="embed-responsive embed-responsive-4by3">
                <div ng-show="chat.gumedia"> 
                    <button type="button" style="position:absolute; top:25%; left:25%;"class="btn btn-primary btn-lg center-block" ng-click="chat.getLocalVideo()">Start Camera</button>
                </div>
                <div ng-show="!chat.gumedia">
                    <video id="localVideo" autoplay muted controls class="localVideo">Your Browser does not support video.</video>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-primary" ng-click="chat.snapPhoto()" ng-disabled="!chat.canPhoto">Snap</button>
                        <button type="button" class="btn btn-primary" ng-click="chat.sendPhoto()" ng-disabled="!chat.picSendReady">Send Photo</button>
                    </div>
                </div>
            </div>
            <br>
<!--------Info Panel!-------->        
            <div class="panel panel-primary porim" ng-cloak>
                <p><b>Peer ID:</b> {{chat.setId}}</p>
                <p><b>Name:</b> {{chat.name}}</p>
            </div>
            <div>
            <form fix-bottom="chat" ng-submit="chat.addMessage()">
            <div id="chat" class="chatBox" style="height:310px; overflow-y:scroll">
                <table class="table">
                    <tbody>
                    <tr ng-repeat="msg in chat.messages ">
                        <td><strong>{{msg.sender}} : </strong>

                        {{msg.message}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
                <input type="text" ng-model="chat.message" class="form-control" placeholder="Enter a Message ">
                <button class="btn btn-primary btn-s" type="submit" ng-hide="true">Submit</button>
            </form>
            </div>
        </div>
    </div>   
    </div>
    <br>
    <br>
<!--------Ids and Usernames!-------->        
    <div>
        <h2>Usernames:</h2>
        <ul>
            <li ng-repeat="user in chat.userNames track by $index">{{user}}</li>
        </ul>
    </div>
    <div>
        <h2>Peer Ids:</h2>
        <ul>
            <li ng-repeat="ids in chat.pids track by $index">{{ids}}</li>
        </ul>
    </div>
</div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="lib/adapter.js"></script>
    <script src="ui-bootstrap-tpls.min.js"></script>
    <script src="app.js"></script>
    <script src="chat.js"></script>
    <script src="chatDirective.js"></script>
    <script src="scroll.js"></script>
    <script src="socket.js"></script>
    <script src="modalService.js"></script>
    <script src="customOnChange.js"></script>
</body>    
</html>